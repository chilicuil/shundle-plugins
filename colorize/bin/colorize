#!/bin/sh

_basename()
{
    [ -z "${1}" ] && return 1 || _basename_var_name="${1}"
    [ -z "${2}" ] || _basename_var_suffix="${2}"
    case "${_basename_var_name}" in
        /*|*/*) _basename_var_name="${_basename_var_name##*/}"
    esac

    if [ -n "${_basename_var_suffix}" ] && [ "${#_basename_var_name}" -gt "${#2}" ]; then
        _basename_var_name="${_basename_var_name%$_basename_var_suffix}"
    fi

    retval="${_basename_var_name}"
    #printf "%s" "${_basename_var_name}"
}

_usage()
{   #prints an usage msg and exits with 0
    printf "%s\\n" "Usage: colorize OPTION [ARGS]"
    printf "\\n"
    printf "%s\\n" "  enable [ps|theme|utils] enable item"
    printf "%s\\n" "  list   [ps|theme|utils] list available items"
    printf "%s\\n" "  show   [ps|theme|utils] show item source"
    return 1
}

_colorize_source()
{
    [ -z "${1}" ] && return 1

    case "${1}" in
        *.ps)    _basename "${1}" .ps;    COLORIZE_PS="${retval}"    ;;
        *.theme) _basename "${1}" .theme; COLORIZE_THEME="${retval}" ;;
        *.utils) _basename "${1}" .utils; COLORIZE_UTILS="${retval}" ;;
    esac
    . "${1}"
}

_colorize_list()
{
    _colorize_list_sourced()
    {
        [ -z "${1}" ] && return 1
        case "${1}" in
            "${COLORIZE_THEME}"|"${COLORIZE_PS}"|"${COLORIZE_UTILS}") return 0 ;;
        esac
        return 1
    }

    _colorize_list_item()
    {
        [ -z "${1}" ] && return 1
        printf "%b%s%b\\n" "${_BIN_SHUNDLE_ENV_BLUE}" "${1}" "${_BIN_SHUNDLE_ENV_NORMAL}"
        for item in "${COLORIZE_PATH}"/"${1}"/*; do
            _basename "${item}" ."${1}"
            bitem="${retval}"
            if _colorize_list_sourced "${bitem}"; then
                printf "%b%s%b\\n" "${_BIN_SHUNDLE_ENV_RED}" " +${bitem}" "${_BIN_SHUNDLE_ENV_NORMAL}"
            else
                printf "%b%s%b\\n" "${_BIN_SHUNDLE_ENV_NORMAL}" "  ${bitem}" "${_BIN_SHUNDLE_ENV_NORMAL}"
            fi
        done
    }

    if [ -z "${1}" ]; then
        _colorize_list_item ps
        printf "\\n"
        _colorize_list_item theme
        printf "\\n"
        _colorize_list_item utils
    else
        case "${1}" in
            p*) _colorize_list_item ps    ;;
            t*) _colorize_list_item theme ;;
            u*) _colorize_list_item utils ;;
            *)  _colorize_list       ;;
        esac
    fi
}

_colorize_enable()
{
    [ -z "${1}" ] && _usage
    if [ -z "${2}" ]; then
        for item in ps theme utils; do
            [ -f "${COLORIZE_PATH}/${item}/${1}.${item}" ] && { _colorize_source "${COLORIZE_PATH}/${item}/${1}.${item}"; return 0; }
        done
    else
        case "${1}" in
            p*) [ -f "${COLORIZE_PATH}/ps/${2}.ps" ]       && _colorize_source "${COLORIZE_PATH}/ps/${2}.ps" ;;
            t*) [ -f "${COLORIZE_PATH}/theme/${2}.theme" ] && _colorize_source "${COLORIZE_PATH}/theme/${2}.theme" ;;
            u*) [ -f "${COLORIZE_PATH}/utils/${2}.utils" ] && _colorize_source "${COLORIZE_PATH}/utils/${2}.utils" ;;
            *)  _colorize_enable "${2}"
        esac
    fi
}

_colorize_show()
{
    [ -z "${1}" ] && _usage

    if [ -z "${2}" ]; then
        for item in ps theme utils; do
            [ -f "${COLORIZE_PATH}/${item}/${1}.${item}" ] && { cat "${COLORIZE_PATH}/${item}/${1}.${item}"; return 0; }
        done
    else
        case "${1}" in
            p*) [ -f "${COLORIZE_PATH}/ps/${2}.ps" ]       && cat "${COLORIZE_PATH}/ps/${2}.ps" ;;
            t*) [ -f "${COLORIZE_PATH}/theme/${2}.theme" ] && cat "${COLORIZE_PATH}/theme/${2}.theme" ;;
            u*) [ -f "${COLORIZE_PATH}/utils/${2}.utils" ] && cat "${COLORIZE_PATH}/utils/${2}.utils" ;;
            *)  _colorize_show "${2}"
        esac
    fi
}

if [ "${#}" -lt "1" ]; then
   _usage
else
    case "${1}" in
        l*) shift; _colorize_list   "${@}";;
        s*) shift; _colorize_show   "${@}";;
        e*) shift; _colorize_enable "${@}";;
        *)  _usage                 ;;
    esac
fi

# vim: set ts=8 sw=4 tw=0 ft=sh :
