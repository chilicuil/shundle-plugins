#bretterpstra

#http://brettterpstra.com/2009/11/17/my-new-favorite-bash-prompt/
prompt_command() {
    if [ $? -eq 0 ]; then # set an error string for the prompt, if applicable
        ERRPROMPT=" "
    else
        ERRPROMPT='->($?) '
    fi
    if type -t __git_ps1;  then # if we're in a Git repo, show current branch
        BRANCH="\$(__git_ps1 '[ %s ] ')"
    fi
    TIME=$(fmt_time) # format time for prompt string
    LOAD=$(uptime|awk '{min=NF-2;print $min}')
    GREEN="\[\033[0;32m\]"
    CYAN="\[\033[0;36m\]"
    BCYAN="\[\033[1;36m\]"
    BLUE="\[\033[0;34m\]"
    GRAY="\[\033[0;37m\]"
    DKGRAY="\[\033[1;30m\]"
    WHITE="\[\033[1;37m\]"
    RED="\[\033[0;31m\]"
    # return color to Terminal setting for text color
    DEFAULT="\[\033[0;39m\]"
    # set the titlebar to the last 2 fields of pwd
    TITLEBAR='\[\e]2;$(pwdtail)\a'
    PS1="\[${TITLEBAR}\]${CYAN}[ ${BCYAN}\u${GREEN}@${BCYAN}\
\h${DKGRAY}(${LOAD}) ${WHITE}${TIME} ${CYAN}]${RED}$ERRPROMPT${GRAY}\
\w\n${GREEN}${BRANCH}${DEFAULT}$ "
}

PROMPT_COMMAND=prompt_command

fmt_time () { #format time just the way I likes it
    if [ $(date +%p) = "PM" ]; then
        meridiem="pm"
    else
        meridiem="am"
    fi
    date +"%l:%M:%S$meridiem"|sed 's/ //g'
}
pwdtail () { #returns the last 2 fields of the working directory
    pwd|awk -F/ '{nlast = NF -1;print $nlast"/"$NF}'
}
chkload () { #gets the current 1m avg CPU load
    CURRLOAD=$(uptime|awk '{print $8}')
    if [ $CURRLOAD -gt 1 ]; then
        OUTP="HIGH"
    elif [ $CURRLOAD -lt 1 ]; then
        OUTP="NORMAL"
    else
        OUTP="UNKNOWN"
    fi
    echo $CURRLOAD
}

# vim: set ts=8 sw=4 tw=0 ft=sh :
